
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Regression with FACET: Predictive Maintenance &#8212; facet  documentation</title>
    
  <link rel="stylesheet" href="../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/gamma.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/js/gamma.js"></script>
    <script src="../_static/js/versions.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Classification with FACET: Prediabetes Study" href="Classification_with_Facet.html" />
    <link rel="prev" title="Introduction to FACET" href="Water_Drilling_Incident_Classification_with_Facet.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    <a class="navbar-brand" href="../index.html">
    
      <img src="../_static/Gamma_Facet_Logo_RGB_LB.svg" class="logo" alt="logo" />
    
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="../getting_started/getting_started.html">Getting started</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../apidoc/facet.html">API reference</a>
        </li>
        
        <li class="nav-item active">
            <a class="nav-link" href="../tutorials.html">Tutorials</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../contribution_guide.html">Development Guidelines</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../faqs.html">FAQ</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../about_us.html">About us</a>
        </li>
        
        
      </ul>


      

      <ul class="navbar-nav">
        
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

    <div class="bd-toc-item active">
    
  
    <ul class="nav bd-sidenav">
        
        
        
        
        
        
          
            
                <li class="">
                    <a href="Water_Drilling_Incident_Classification_with_Facet.html">Introduction to FACET</a>
                </li>
            
          
            
                <li class="active">
                    <a href="">Regression with FACET: Predictive Maintenance</a>
                </li>
            
          
            
                <li class="">
                    <a href="Classification_with_Facet.html">Classification with FACET: Prediabetes Study</a>
                </li>
            
          
            
                <li class="">
                    <a href="Model_simulation_deep_dive.html">Bootstrap simulation with FACET</a>
                </li>
            
          
            
                <li class="">
                    <a href="Scikit-learn_classifier_summaries_using_FACET.html">Standard Scikit-learn Classification Summary with FACET</a>
                </li>
            
          
            
                <li class="">
                    <a href="Synergy_Redundancy_Tutorial_with_Facet.html">Intuition on synergy & redundancy</a>
                </li>
            
          
        
        
        
        
        
        
        
        
      </ul>
  
  </nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#" class="nav-link">Regression with FACET: Predictive Maintenance</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Required-imports" class="nav-link">Required imports</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Preprocessing-and-initial-feature-selection" class="nav-link">Preprocessing and initial feature selection</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Selecting-a-learner-using-FACET-ranker" class="nav-link">Selecting a learner using FACET ranker</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Using-FACET-for-advanced-model-inspection" class="nav-link">Using FACET for advanced model inspection</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#Synergy" class="nav-link">Synergy</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#Redundancy" class="nav-link">Redundancy</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#Feature-clustering" class="nav-link">Feature clustering</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#FACET-univariate-simulator:-the-impact-of-compressor-outlet-air-temp" class="nav-link">FACET univariate simulator: the impact of compressor outlet air temp</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Summary" class="nav-link">Summary</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Appendix" class="nav-link">Appendix</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#Data-source" class="nav-link">Data source</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#Exploratory-Data-Analysis-(EDA)" class="nav-link">Exploratory Data Analysis (EDA)</a>
        </li>
    
            </ul>
        </li>
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<p><img alt="9727d42b4f3f4425b592d2d557cb19a0" class="no-scaled-link" src="../_images/Gamma_Facet_Logo_RGB_LB2.svg" width="500" /></p>
<div class="section" id="Regression-with-FACET:-Predictive-Maintenance">
<h1>Regression with FACET: Predictive Maintenance<a class="headerlink" href="#Regression-with-FACET:-Predictive-Maintenance" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<p>FACET is composed of the following key components:</p>
<ul>
<li><p><strong>Model Inspection</strong></p>
<p>FACET introduces a new algorithm to quantify dependencies and interactions between features in ML models. This new tool for human-explainable AI adds a new, global perspective to the observation-level explanations provided by the popular <a class="reference external" href="https://shap.readthedocs.io/en/latest/">SHAP</a> approach. To learn more about FACET’s model inspection capabilities, see the getting started example below.</p>
</li>
<li><p><strong>Model Simulation</strong></p>
<p>FACET’s model simulation algorithms use ML models for <em>virtual experiments</em> to help identify scenarios that optimise predicted outcomes. To quantify the uncertainty in simulations, FACET utilises a range of bootstrapping algorithms including stationary and stratified bootstraps. For an example of FACET’s bootstrap simulations, see the getting started example below.</p>
</li>
<li><p><strong>Enhanced Machine Learning Workflow</strong></p>
<p>FACET offers an efficient and transparent machine learning workflow, enhancing <a class="reference external" href="https://scikit-learn.org/stable/index.html">scikit-learn</a>’s tried and tested pipelining paradigm with new capabilities for model selection, inspection, and simulation. FACET also introduces <a class="reference external" href="https://github.com/BCG-Gamma/sklearndf">sklearndf</a>, an augmented version of <em>scikit-learn</em> with enhanced support for <em>pandas</em> dataframes that ensures end-to-end traceability of features.</p>
</li>
</ul>
<hr class="docutils" />
<p><strong>Context</strong></p>
<p>The data are from simulated experiments of a naval vessel (Frigate) Gas Turbine (GT) propulsion plant. The simulator considers the performance decay over time of the GT components such as GT compressor and turbines. One observation in this dataset represents the current decay states of the compressor and the gas turbine along with several sensor readings of the vessel at that point in time. The decay state is a performance metric [0, 1] where 1 means delivering 100% of nominal performance. We
want to determine the machine settings which maximize the gas turbine decay state coefficient.</p>
<p>Utilizing FACET, we will:</p>
<ol class="arabic simple">
<li><p>Predict the decay state of the gas turbine as accurately as possible</p></li>
<li><p>Understand which parameters drive the decay state of the turbine</p></li>
<li><p>Analyse how these drivers interact with each other and the target</p></li>
</ol>
<p>While we can solve questions 1 and parts of question 2 with commonly used machine learning packages, FACET will enable us to make better inferences about the way some of the features share or complement information and help us to figure out the optimal settings of the vessel to minimize the equipment degradation at a variety of ship speeds.</p>
<hr class="docutils" />
<p><strong>Tutorial outline</strong></p>
<ol class="arabic simple">
<li><p><a class="reference external" href="#Required-imports">Required imports</a></p></li>
<li><p><a class="reference external" href="#Preprocessing-and-initial-feature-selection">Preprocessing and initial feature selection</a></p></li>
<li><p><a class="reference external" href="#Selecting-a-learner-using-FACET-ranker">Selecting a learner using FACET ranker</a></p></li>
<li><p><a class="reference external" href="#Using-FACET-for-advanced-model-inspection">Using FACET for advanced model inspection</a></p></li>
<li><p><a class="reference external" href="#FACET-univariate-simulator:-the-impact-of-compressor-outlet-air-temp">FACET univariate simulator: the impact of compressor outlet air temp</a></p></li>
<li><p><a class="reference external" href="#Summary">Summary</a></p></li>
<li><p><a class="reference external" href="#Appendix">Appendix</a></p></li>
</ol>
</div>
<div class="section" id="Required-imports">
<h1>Required imports<a class="headerlink" href="#Required-imports" title="Permalink to this headline">¶</a></h1>
<p>In order to run this notebook, we will import not only the FACET package, but also other packages useful to solve this task. Overall, we can break down the imports into three categories:</p>
<ol class="arabic simple">
<li><p>Common packages (pandas, matplotlib, etc.)</p></li>
<li><p>Required FACET classes (inspection, selection, validation, simulation, etc.)</p></li>
<li><p>Other BCG GAMMA packages which simplify pipelining (sklearndf, see on <a class="reference external" href="https://github.com/BCG-Gamma/sklearndf/">GitHub</a>) and support visualization (pytools, see on <a class="reference external" href="https://github.com/BCG-Gamma/pytools">GitHub</a>) when using FACET</p></li>
</ol>
<p><strong>Common package imports</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">RepeatedKFold</span>
</pre></div>
</div>
</div>
<p><strong>FACET imports</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">facet.data</span> <span class="kn">import</span> <span class="n">Sample</span>
<span class="kn">from</span> <span class="nn">facet.crossfit</span> <span class="kn">import</span> <span class="n">LearnerCrossfit</span>
<span class="kn">from</span> <span class="nn">facet.inspection</span> <span class="kn">import</span> <span class="n">LearnerInspector</span>
<span class="kn">from</span> <span class="nn">facet.selection</span> <span class="kn">import</span> <span class="n">LearnerRanker</span><span class="p">,</span> <span class="n">LearnerGrid</span>
<span class="kn">from</span> <span class="nn">facet.validation</span> <span class="kn">import</span> <span class="n">BootstrapCV</span>
<span class="kn">from</span> <span class="nn">facet.simulation.partition</span> <span class="kn">import</span> <span class="n">ContinuousRangePartitioner</span>
<span class="kn">from</span> <span class="nn">facet.simulation</span> <span class="kn">import</span> <span class="n">UnivariateUpliftSimulator</span>
<span class="kn">from</span> <span class="nn">facet.simulation.viz</span> <span class="kn">import</span> <span class="n">SimulationDrawer</span>
</pre></div>
</div>
</div>
<p><strong>sklearndf imports</strong></p>
<p>Instead of using the “regular” scikit-learn package, we are going to use sklearndf (see on <a class="reference external" href="https://github.com/BCG-Gamma/sklearndf/">GitHub</a>). sklearndf is an open source library designed to address a common issue with scikit-learn: the outputs of transformers are numpy arrays, even when the input is a data frame. However, to inspect a model it is essential to keep track of the feature names. sklearndf retains all the functionality available through scikit-learn plus the feature traceability
and usability associated with Pandas data frames. Additionally, the names of all your favourite scikit-learn functions are the same except for <code class="docutils literal notranslate"><span class="pre">DF</span></code> on the end. For example, the standard scikit-learn import:</p>
<p><code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">sklearn.pipeline</span> <span class="pre">import</span> <span class="pre">Pipeline</span></code></p>
<p>becomes:</p>
<p><code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">sklearndf.pipeline</span> <span class="pre">import</span> <span class="pre">PipelineDF</span></code></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">sklearndf.pipeline</span> <span class="kn">import</span> <span class="n">PipelineDF</span><span class="p">,</span> <span class="n">RegressorPipelineDF</span>
<span class="kn">from</span> <span class="nn">sklearndf.regression</span> <span class="kn">import</span> <span class="n">RandomForestRegressorDF</span>
<span class="kn">from</span> <span class="nn">sklearndf.regression.extra</span> <span class="kn">import</span> <span class="n">LGBMRegressorDF</span>
<span class="kn">from</span> <span class="nn">sklearndf.transformation.extra</span> <span class="kn">import</span> <span class="n">BorutaDF</span>
<span class="kn">from</span> <span class="nn">sklearndf.transformation</span> <span class="kn">import</span> <span class="n">SimpleImputerDF</span>
</pre></div>
</div>
</div>
<p><strong>pytools imports</strong></p>
<p>pytools (see on <a class="reference external" href="https://github.com/BCG-Gamma/pytools">GitHub</a>) is an open source library containing general machine learning and visualization utilities, some of which are useful for visualising the advanced model inspection capabilities of FACET.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">pytools.viz.dendrogram</span> <span class="kn">import</span> <span class="n">DendrogramDrawer</span><span class="p">,</span> <span class="n">DendrogramReportStyle</span>
<span class="kn">from</span> <span class="nn">pytools.viz.distribution</span> <span class="kn">import</span> <span class="n">ECDFDrawer</span>
<span class="kn">from</span> <span class="nn">pytools.viz.matrix</span> <span class="kn">import</span> <span class="n">MatrixDrawer</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Preprocessing-and-initial-feature-selection">
<h1>Preprocessing and initial feature selection<a class="headerlink" href="#Preprocessing-and-initial-feature-selection" title="Permalink to this headline">¶</a></h1>
<p>First, we need to load our turbine decay data and create a simple preprocessing pipeline. For those interested initial EDA can be found in the Appendix <a class="reference external" href="#Exploratory-Data-Analysis">Exploratory Data Analysis</a></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># load the prepared data frame</span>
<span class="n">decay_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s2">&quot;sphinx/source/tutorial/gas_turbine_data.txt&quot;</span><span class="p">,</span> <span class="n">delim_whitespace</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="c1"># assign human-readable labels</span>
<span class="n">decay_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Lever Position&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Ship Speed&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Turbine Shaft Torque (kN m)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Turbine Rate of Revolutions (rpm)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Generator Rate of Revolutions (rpm)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Starboard Propeller Torque (kN)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Port Propeller Torque (kN)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HP Turbine exit temp (C)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GT Compressor inlet air temp (C)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GT Compressor outlet air temp (C)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Turbine exit pressure (bar)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Compressor inlet air pressure (bar)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Compressor outlet air pressure (bar)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Turbine exhaust gas pressure (bar)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Turbine injection control&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Fuel flow&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GT Compressor decay state coeff&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GT Turbine decay state coeff&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># need to drop the other target</span>
<span class="n">decay_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;GT Compressor decay state coeff&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># to ensure quick running we will use a random sample of 2500 observations</span>
<span class="n">decay_df</span> <span class="o">=</span> <span class="n">decay_df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2500</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># have a look</span>
<span class="n">decay_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Lever Position</th>
      <th>Ship Speed</th>
      <th>Turbine Shaft Torque (kN m)</th>
      <th>Turbine Rate of Revolutions (rpm)</th>
      <th>Generator Rate of Revolutions (rpm)</th>
      <th>Starboard Propeller Torque (kN)</th>
      <th>Port Propeller Torque (kN)</th>
      <th>HP Turbine exit temp (C)</th>
      <th>GT Compressor inlet air temp (C)</th>
      <th>GT Compressor outlet air temp (C)</th>
      <th>Turbine exit pressure (bar)</th>
      <th>Compressor inlet air pressure (bar)</th>
      <th>Compressor outlet air pressure (bar)</th>
      <th>Turbine exhaust gas pressure (bar)</th>
      <th>Turbine injection control</th>
      <th>Fuel flow</th>
      <th>GT Turbine decay state coeff</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10172</th>
      <td>4.161</td>
      <td>12.0</td>
      <td>14718.310</td>
      <td>1547.449</td>
      <td>7719.516</td>
      <td>113.742</td>
      <td>113.742</td>
      <td>631.252</td>
      <td>288.0</td>
      <td>602.602</td>
      <td>1.664</td>
      <td>0.998</td>
      <td>8.939</td>
      <td>1.023</td>
      <td>16.815</td>
      <td>0.333</td>
      <td>0.987</td>
    </tr>
    <tr>
      <th>10322</th>
      <td>1.138</td>
      <td>3.0</td>
      <td>3348.329</td>
      <td>1356.770</td>
      <td>6601.505</td>
      <td>7.894</td>
      <td>7.894</td>
      <td>547.508</td>
      <td>288.0</td>
      <td>557.501</td>
      <td>1.213</td>
      <td>0.998</td>
      <td>6.598</td>
      <td>1.019</td>
      <td>14.993</td>
      <td>0.192</td>
      <td>0.978</td>
    </tr>
    <tr>
      <th>9195</th>
      <td>8.206</td>
      <td>24.0</td>
      <td>50992.407</td>
      <td>3087.412</td>
      <td>9298.581</td>
      <td>438.063</td>
      <td>438.063</td>
      <td>918.698</td>
      <td>288.0</td>
      <td>728.328</td>
      <td>3.599</td>
      <td>0.998</td>
      <td>18.620</td>
      <td>1.042</td>
      <td>60.231</td>
      <td>1.192</td>
      <td>0.982</td>
    </tr>
    <tr>
      <th>357</th>
      <td>8.206</td>
      <td>24.0</td>
      <td>50997.290</td>
      <td>3087.621</td>
      <td>9322.654</td>
      <td>438.113</td>
      <td>438.113</td>
      <td>938.022</td>
      <td>288.0</td>
      <td>739.339</td>
      <td>3.565</td>
      <td>0.998</td>
      <td>18.359</td>
      <td>1.041</td>
      <td>61.146</td>
      <td>1.211</td>
      <td>0.988</td>
    </tr>
    <tr>
      <th>4352</th>
      <td>7.148</td>
      <td>21.0</td>
      <td>38986.686</td>
      <td>2678.079</td>
      <td>9131.082</td>
      <td>332.171</td>
      <td>332.171</td>
      <td>827.022</td>
      <td>288.0</td>
      <td>691.694</td>
      <td>2.967</td>
      <td>0.998</td>
      <td>15.482</td>
      <td>1.035</td>
      <td>44.017</td>
      <td>0.872</td>
      <td>0.990</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>For easier data management we will create a sample object using FACET’s <code class="docutils literal notranslate"><span class="pre">Sample</span></code> class, which allows us to:</p>
<ul class="simple">
<li><p>Quickly access the target vs. features</p></li>
<li><p>Pass our data into sklearndf pipelines</p></li>
<li><p>Pass information to other FACET functions</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">decay_obs</span> <span class="o">=</span> <span class="n">Sample</span><span class="p">(</span><span class="n">observations</span><span class="o">=</span><span class="n">decay_df</span><span class="p">,</span> <span class="n">target_name</span><span class="o">=</span><span class="s2">&quot;GT Turbine decay state coeff&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Next, we should create a minimum preprocessing pipeline. However, based on our EDA (<a class="reference external" href="#Exploratory-Data-Analysis-(EDA)">Exploratory Data Analysis</a> ) we have no missing values or a need to manage categorical variables etc. However, while it is not needed we will create a simple imputation preprocessing pipeline using sklearndf’s <code class="docutils literal notranslate"><span class="pre">SimpleImputerDF</span></code> to demonstrate how such a pipeline is created and included in subsequent analytic steps.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">feature_preprocessing</span> <span class="o">=</span> <span class="n">PipelineDF</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;impute&quot;</span><span class="p">,</span> <span class="n">SimpleImputerDF</span><span class="p">())])</span>
</pre></div>
</div>
</div>
<p>Next, we perform some initial feature selection using Boruta, a recent approach shown to have quite good performance. The Boruta algorithm removes features that are no more predictive than random noise. If you are interested further, please see this <a class="reference external" href="https://www.jstatsoft.org/article/view/v036i11">article</a>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">BorutaDF</span></code> transformer in sklearndf package provides easy access to this powerful method. The approach relies on a tree-based learner, usually a random forest. For settings, a <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> of between 3 and 7 is typically recommended, and here we rely on the default setting of 5. However, as this depends on the number of features and the complexity of interactions one could also explore the sensitivity of feature selection to this parameter. The number of trees is automatically managed by
the Boruta feature selector argument <code class="docutils literal notranslate"><span class="pre">n_estimators=&quot;auto&quot;</span></code>.</p>
<p>We also use parallelization for the random forest using <code class="docutils literal notranslate"><span class="pre">n_jobs</span></code> to accelerate the Boruta iterations.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># create the Boruta object</span>
<span class="n">boruta_feat_select</span> <span class="o">=</span> <span class="n">BorutaDF</span><span class="p">(</span>
    <span class="n">estimator</span><span class="o">=</span><span class="n">RandomForestRegressorDF</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">3</span><span class="p">),</span>
    <span class="n">n_estimators</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
    <span class="n">max_iter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># combine Boruta with the preprocessing pipeline</span>
<span class="n">selection_pipeline</span> <span class="o">=</span> <span class="n">PipelineDF</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;preprocessing&quot;</span><span class="p">,</span> <span class="n">feature_preprocessing</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;feature selection&quot;</span><span class="p">,</span> <span class="n">boruta_feat_select</span><span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Since <a class="reference external" href="https://github.com/BCG-Gamma/sklearndf">sklearndf</a> closely follows the <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code> syntax, we can fit this pipeline on the <code class="docutils literal notranslate"><span class="pre">sample.features</span></code> and <code class="docutils literal notranslate"><span class="pre">sample.target</span></code> properties.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># fit pipeline and print selected features</span>
<span class="n">selection_pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">decay_obs</span><span class="o">.</span><span class="n">features</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">decay_obs</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Selected features: </span><span class="si">{</span><span class="n">selection_pipeline</span><span class="o">.</span><span class="n">feature_names_original_</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Selected features: [&#39;Turbine Shaft Torque (kN m)&#39; &#39;Turbine Rate of Revolutions (rpm)&#39;
 &#39;Generator Rate of Revolutions (rpm)&#39; &#39;HP Turbine exit temp (C)&#39;
 &#39;GT Compressor outlet air temp (C)&#39; &#39;Turbine exit pressure (bar)&#39;
 &#39;Compressor outlet air pressure (bar)&#39;
 &#39;Turbine exhaust gas pressure (bar)&#39; &#39;Turbine injection control&#39;
 &#39;Fuel flow&#39;]
</pre></div></div>
</div>
<p>Boruta selected 10 features which we will now keep in our FACET sample object. Note that this feature selection process could be included in a general preprocessing pipeline, however due to the computation involved, we have utilized Boruta here as an initial one-off processing step to narrow down the features for our classifier development.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># update FACET sample object to only those features Boruta identified as useful</span>
<span class="n">decay_obs_initial_features</span> <span class="o">=</span> <span class="n">decay_obs</span><span class="o">.</span><span class="n">keep</span><span class="p">(</span>
    <span class="n">feature_names</span><span class="o">=</span><span class="n">selection_pipeline</span><span class="o">.</span><span class="n">feature_names_original_</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Selecting-a-learner-using-FACET-ranker">
<h1>Selecting a learner using FACET ranker<a class="headerlink" href="#Selecting-a-learner-using-FACET-ranker" title="Permalink to this headline">¶</a></h1>
<p>FACET implements several additional useful wrappers which further simplify comparing and tuning a larger number of models and configurations:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">LearnerGrid</span></code>: allows you to pass a learner pipeline (i.e., regressor + any preprocessing) and a set of hyperparameters</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LearnerRanker</span></code>: multiple LearnerGrids can be passed into this class as a list - this allows tuning hyperparameters both across different types of learners in a single step and ranks the resulting models accordingly</p></li>
</ul>
<p>The following learners and hyperparameter ranges will be assessed using 10 repeated 5-fold cross-validation:</p>
<ol class="arabic simple">
<li><p><strong>Random forest</strong>: with hyperparameters</p>
<ul class="simple">
<li><p>min_samples_leaf: [8, 16]</p></li>
<li><p>n_estimators: [20, 50, 100]</p></li>
</ul>
</li>
<li><p><strong>Light gradient boosting</strong>: with hyperparameters</p>
<ul class="simple">
<li><p>min_data_in_leaf: [8, 16]</p></li>
<li><p>subsample: [0.8, 1]</p></li>
<li><p>boosting_type: [“gbdt”]</p></li>
</ul>
</li>
</ol>
<p>Note if you want to see a list of hyperparameters you can use <code class="docutils literal notranslate"><span class="pre">regressor_name().get_params().keys()</span></code> where <code class="docutils literal notranslate"><span class="pre">regressor_name</span></code> could be for example <code class="docutils literal notranslate"><span class="pre">RandomForestRegressorDF</span></code> and if you want to see the default values, just use <code class="docutils literal notranslate"><span class="pre">regressor_name().get_params()</span></code>.</p>
<p>Finally, for this exercise we will use the default performance metric for scoring and ranking our regressors, which is explained variance. Note that ranking uses the average performance minus two times the standard deviation, so that we consider both the average performance and variability when selecting a regressor.</p>
<p>First, we specify the classifiers we want to train using <code class="docutils literal notranslate"><span class="pre">RegressorPipelineDF</span></code> from sklearndf. Note here we could also include any feature preprocessing steps by using the <code class="docutils literal notranslate"><span class="pre">preprocessing</span></code> argument.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rforest_regressor</span> <span class="o">=</span> <span class="n">RegressorPipelineDF</span><span class="p">(</span>
    <span class="n">regressor</span><span class="o">=</span><span class="n">RandomForestRegressorDF</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">lgbm_regressor</span> <span class="o">=</span> <span class="n">RegressorPipelineDF</span><span class="p">(</span>
    <span class="n">regressor</span><span class="o">=</span><span class="n">LGBMRegressorDF</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Then we create a list of learner grids where each learner grid is created using <code class="docutils literal notranslate"><span class="pre">LearnerGrid</span></code> and allows us to associate a <code class="docutils literal notranslate"><span class="pre">RegressorPipelineDF</span></code> with a specified set of hyperparameter via the <code class="docutils literal notranslate"><span class="pre">learner_parameters</span></code> argument. Note this structure allows us to easily include additional regressors and hyperparameters.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">regressor_grid</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">LearnerGrid</span><span class="p">(</span>
        <span class="n">pipeline</span><span class="o">=</span><span class="n">rforest_regressor</span><span class="p">,</span>
        <span class="n">learner_parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;min_samples_leaf&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">],</span> <span class="s2">&quot;n_estimators&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">]},</span>
    <span class="p">),</span>
    <span class="n">LearnerGrid</span><span class="p">(</span>
        <span class="n">pipeline</span><span class="o">=</span><span class="n">lgbm_regressor</span><span class="p">,</span>
        <span class="n">learner_parameters</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;min_data_in_leaf&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">],</span>
            <span class="s2">&quot;subsample&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="s2">&quot;boosting_type&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;gbdt&quot;</span><span class="p">],</span>
        <span class="p">},</span>
    <span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<p>We now fit the grid defined above using the <code class="docutils literal notranslate"><span class="pre">LeanerRanker</span></code>, which will run a gridsearch (or random search if defined) using 10 repeated 5-fold cross-validation on our selected set of features from Boruta.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">regressor_ranker</span> <span class="o">=</span> <span class="n">LearnerRanker</span><span class="p">(</span>
    <span class="n">grids</span><span class="o">=</span><span class="n">regressor_grid</span><span class="p">,</span>
    <span class="n">cv</span><span class="o">=</span><span class="n">RepeatedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_repeats</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">scoring</span><span class="o">=</span><span class="s2">&quot;explained_variance&quot;</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">sample</span><span class="o">=</span><span class="n">decay_obs_initial_features</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[LightGBM] [Warning] min_data_in_leaf is set=8, min_child_samples=20 will be ignored. Current value: min_data_in_leaf=8
</pre></div></div>
</div>
<p>We can see how each model scored using the <code class="docutils literal notranslate"><span class="pre">summary_report()</span></code> method of the <code class="docutils literal notranslate"><span class="pre">LearnerRanker</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># let&#39;s look at performance for the top 5 ranked regressors</span>
<span class="n">regressor_ranker</span><span class="o">.</span><span class="n">summary_report</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>ranking_score</th>
      <th colspan="2" halign="left">explained_variance</th>
      <th colspan="6" halign="left">regressor</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th>mean</th>
      <th>std</th>
      <th>type</th>
      <th>n_estimators</th>
      <th>min_samples_leaf</th>
      <th>subsample</th>
      <th>boosting_type</th>
      <th>min_data_in_leaf</th>
    </tr>
    <tr>
      <th>rank</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.941008</td>
      <td>0.957769</td>
      <td>0.008381</td>
      <td>LGBMRegressorDF</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.8</td>
      <td>gbdt</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.941008</td>
      <td>0.957769</td>
      <td>0.008381</td>
      <td>LGBMRegressorDF</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>gbdt</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.935509</td>
      <td>0.952824</td>
      <td>0.008658</td>
      <td>LGBMRegressorDF</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.8</td>
      <td>gbdt</td>
      <td>16.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.935509</td>
      <td>0.952824</td>
      <td>0.008658</td>
      <td>LGBMRegressorDF</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>gbdt</td>
      <td>16.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.876689</td>
      <td>0.903802</td>
      <td>0.013557</td>
      <td>RandomForestRegressorDF</td>
      <td>100.0</td>
      <td>8.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.876476</td>
      <td>0.903111</td>
      <td>0.013318</td>
      <td>RandomForestRegressorDF</td>
      <td>50.0</td>
      <td>8.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.873774</td>
      <td>0.900475</td>
      <td>0.013351</td>
      <td>RandomForestRegressorDF</td>
      <td>20.0</td>
      <td>8.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.817858</td>
      <td>0.849153</td>
      <td>0.015647</td>
      <td>RandomForestRegressorDF</td>
      <td>100.0</td>
      <td>16.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.817152</td>
      <td>0.848478</td>
      <td>0.015663</td>
      <td>RandomForestRegressorDF</td>
      <td>50.0</td>
      <td>16.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.814505</td>
      <td>0.846019</td>
      <td>0.015757</td>
      <td>RandomForestRegressorDF</td>
      <td>20.0</td>
      <td>16.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>We can see based on our learner ranker, we have selected a LGBM algorithm that achieved a mean explained variance of 0.96 with a SD of 0.01.</p>
</div>
<div class="section" id="Using-FACET-for-advanced-model-inspection">
<h1>Using FACET for advanced model inspection<a class="headerlink" href="#Using-FACET-for-advanced-model-inspection" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference external" href="http://papers.nips.cc/paper/7062-a-unified-approach-to-interpreting-model-predictions">SHAP approach</a> has become the standard method for model inspection. SHAP values are used to explain the additive contribution of each feature to the prediction for each observation (i.e., explain <strong>individual</strong> predictions).</p>
<p>The FACET <code class="docutils literal notranslate"><span class="pre">LearnerInspector</span></code> computes SHAP values for each crossfit (i.e., a CV fold or bootstrap resample) using the best model identified by the <code class="docutils literal notranslate"><span class="pre">LearnerRanker</span></code>. The FACET <code class="docutils literal notranslate"><span class="pre">LearnerInspector</span></code> then provides advanced model inspection through new SHAP-based summary metrics for understanding pairwise feature redundancy and synergy. Redundancy and synergy are calculated using a new algorithm to understand model predictions from a <strong>global perspective</strong> to complement local SHAP.</p>
<p>The definitions of synergy and redundancy are as follows:</p>
<ul>
<li><p><strong>Synergy</strong></p>
<p>The degree to which the model combines information from one feature with another to predict the target. For example, let’s assume we are predicting cardiovascular health using age and gender and the fitted model includes a complex interaction between them. This means these two features are synergistic for predicting cardiovascular health. Further, both features are important to the model and removing either one would significantly impact performance. Let’s assume age brings more information
to the joint contribution than gender. This asymmetric contribution means the synergy for (age, gender) is less than the synergy for (gender, age). To think about it another way, imagine the prediction is a coordinate you are trying to reach. From your starting point, age gets you much closer to this point than gender, however, you need both to get there. Synergy reflects the fact that gender gets more help from age (higher synergy from the perspective of gender) than age does from gender
(lower synergy from the perspective of age) to reach the prediction. <em>This leads to an important point: synergy is a naturally asymmetric property of the global information two interacting features contribute to the model predictions.</em> Synergy is expressed as a percentage ranging from 0% (full autonomy) to 100% (full synergy).</p>
</li>
<li><p><strong>Redundancy</strong></p>
<p>The degree to which a feature in a model duplicates the information of a second feature to predict the target. For example, let’s assume we had house size and number of bedrooms for predicting house price. These features capture similar information as the more bedrooms the larger the house and likely a higher price on average. The redundancy for (number of bedrooms, house size) will be greater than the redundancy for (house size, number of bedrooms). This is because house size “knows” more of
what number of bedrooms does for predicting house price than vice-versa. Hence, there is greater redundancy from the perspective of number of bedrooms. Another way to think about it is removing house size will be more detrimental to model performance than removing number of bedrooms, as house size can better compensate for the absence of number of bedrooms. This also implies that house size would be a more important feature than number of bedrooms in the model. <em>The important point here is
that like synergy, redundancy is a naturally asymmetric property of the global information feature pairs have for predicting an outcome.</em> Redundancy is expressed as a percentage ranging from 0% (full uniqueness) to 100% (full redundancy).</p>
</li>
</ul>
<p>Note that cases can apply at the same time so a feature pair can use some information synergistically and some information redundantly.</p>
<p>The FACET <code class="docutils literal notranslate"><span class="pre">LearnerInspector</span></code> can calculate all of this with a single method call, but also offers methods to access the intermediate results of each step. A lightweight visualization framework is available to render the results in different styles.</p>
<p>SHAP values from the <code class="docutils literal notranslate"><span class="pre">LearnerInspector</span></code> can also be used with the SHAP package plotting functions for sample and observation level SHAP visualizations, such as SHAP distribution plots, dependency plots, force plots and waterfall plots.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># run inspector</span>
<span class="n">regression_inspector</span> <span class="o">=</span> <span class="n">LearnerInspector</span><span class="p">()</span>
<span class="n">regression_inspector</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">3</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">crossfit</span><span class="o">=</span><span class="n">regressor_ranker</span><span class="o">.</span><span class="n">best_model_crossfit_</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Setting feature_perturbation = &#34;tree_path_dependent&#34; because no background data was given.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;facet.inspection._inspection.LearnerInspector at 0x1ab10ed4c40&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># quick look at feature importance</span>
<span class="n">regression_inspector</span><span class="o">.</span><span class="n">feature_importance</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
feature
Compressor outlet air pressure (bar)    0.256469
Generator Rate of Revolutions (rpm)     0.155129
Turbine Shaft Torque (kN m)             0.132486
Turbine Rate of Revolutions (rpm)       0.129988
Turbine exhaust gas pressure (bar)      0.107262
GT Compressor outlet air temp (C)       0.071312
Turbine injection control               0.061194
Fuel flow                               0.044075
Turbine exit pressure (bar)             0.025341
HP Turbine exit temp (C)                0.016744
Name: GT Turbine decay state coeff, dtype: float64
</pre></div></div>
</div>
<div class="section" id="Synergy">
<h2>Synergy<a class="headerlink" href="#Synergy" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># synergy heatmaps</span>
<span class="n">synergy_matrix</span> <span class="o">=</span> <span class="n">regression_inspector</span><span class="o">.</span><span class="n">feature_synergy_matrix</span><span class="p">()</span>
<span class="n">MatrixDrawer</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;matplot%&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">synergy_matrix</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Feature synergies&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Predictive_Maintenance_Regression_with_Facet_41_0.png" src="../_images/tutorial_Predictive_Maintenance_Regression_with_Facet_41_0.png" />
</div>
</div>
<p>To interpret the synergy matrix, the first feature in a pair is the row (“perspective from”), and the second feature the column. For example, let’s take the highest synergy value of 50% for the feature pair (<code class="docutils literal notranslate"><span class="pre">Turbine</span> <span class="pre">exhaust</span> <span class="pre">gas</span> <span class="pre">pressure</span> <span class="pre">(bar)</span></code>, <code class="docutils literal notranslate"><span class="pre">Compressor</span> <span class="pre">outlet</span> <span class="pre">air</span> <span class="pre">pressure</span> <span class="pre">(bar)</span></code>). This means from the perspective of <code class="docutils literal notranslate"><span class="pre">Turbine</span> <span class="pre">exhaust</span> <span class="pre">gas</span> <span class="pre">pressure</span> <span class="pre">(bar)</span></code> we find that 50% of the information is combined with <code class="docutils literal notranslate"><span class="pre">Compressor</span> <span class="pre">outlet</span> <span class="pre">air</span> <span class="pre">pressure</span> <span class="pre">(bar)</span></code> to predict the decay state of the gas
turbine.</p>
<p>Further if we look at the column for <code class="docutils literal notranslate"><span class="pre">Compressor</span> <span class="pre">outlet</span> <span class="pre">air</span> <span class="pre">pressure</span> <span class="pre">(bar)</span></code>, we see from the perspective of other features in the model the synergy with <code class="docutils literal notranslate"><span class="pre">Compressor</span> <span class="pre">outlet</span> <span class="pre">air</span> <span class="pre">pressure</span> <span class="pre">(bar)</span></code> ranges from 15% to 50%. This indicates that <code class="docutils literal notranslate"><span class="pre">Compressor</span> <span class="pre">outlet</span> <span class="pre">air</span> <span class="pre">pressure</span> <span class="pre">(bar)</span></code> is a strong independent feature in the model (it actually has the highest feature importance in the model) and that contributions of other features to predicting the decay state of the gas turbine are partly enabled by
<code class="docutils literal notranslate"><span class="pre">Compressor</span> <span class="pre">outlet</span> <span class="pre">air</span> <span class="pre">pressure</span> <span class="pre">(bar)</span></code>.</p>
</div>
<div class="section" id="Redundancy">
<h2>Redundancy<a class="headerlink" href="#Redundancy" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># redundancy heatmap</span>
<span class="n">redundancy_matrix</span> <span class="o">=</span> <span class="n">regression_inspector</span><span class="o">.</span><span class="n">feature_redundancy_matrix</span><span class="p">()</span>
<span class="n">MatrixDrawer</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;matplot%&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">redundancy_matrix</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Feature redundancies&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Predictive_Maintenance_Regression_with_Facet_44_0.png" src="../_images/tutorial_Predictive_Maintenance_Regression_with_Facet_44_0.png" />
</div>
</div>
<p>As with synergy, the matrix row is the “perspective from” feature in the row-column feature pair. Let’s continue with the most important feature in the model <code class="docutils literal notranslate"><span class="pre">Compressor</span> <span class="pre">outlet</span> <span class="pre">air</span> <span class="pre">pressure</span> <span class="pre">(bar)</span></code>. If we look across the row for <code class="docutils literal notranslate"><span class="pre">Compressor</span> <span class="pre">outlet</span> <span class="pre">air</span> <span class="pre">pressure</span> <span class="pre">(bar)</span></code> which is redundancy from the perspective of <code class="docutils literal notranslate"><span class="pre">Compressor</span> <span class="pre">outlet</span> <span class="pre">air</span> <span class="pre">pressure</span> <span class="pre">(bar)</span></code> we can see that it has little redundancy with the other models features (4.5% to 25%). If look along the column for
<code class="docutils literal notranslate"><span class="pre">Compressor</span> <span class="pre">outlet</span> <span class="pre">air</span> <span class="pre">pressure</span> <span class="pre">(bar)</span></code> we can see from the perspective of the other model features there is a moderate degree of redundancy with <code class="docutils literal notranslate"><span class="pre">Compressor</span> <span class="pre">outlet</span> <span class="pre">air</span> <span class="pre">pressure</span> <span class="pre">(bar)</span></code>, ranging from 29% to 65%.</p>
<p>We can also see the highest redundancy (76%) is for (<code class="docutils literal notranslate"><span class="pre">Fuel</span> <span class="pre">flow</span></code>, <code class="docutils literal notranslate"><span class="pre">Turbine</span> <span class="pre">injection</span> <span class="pre">control</span></code>). This would mean that from the perspective of <code class="docutils literal notranslate"><span class="pre">Fuel</span> <span class="pre">flow</span></code> 76% of the information is duplicated with <code class="docutils literal notranslate"><span class="pre">Turbine</span> <span class="pre">injection</span> <span class="pre">control</span></code> to predict the decay state of the gas turbine. Intuitively this makes sense as fuel flow is a consequence of the turbine injection control.</p>
</div>
<div class="section" id="Feature-clustering">
<h2>Feature clustering<a class="headerlink" href="#Feature-clustering" title="Permalink to this headline">¶</a></h2>
<p>As detailed above redundancy and synergy for a feature pair is from the “perspective” of one of the features in the pair, and so yields two distinct values. However, a symmetric version can also be computed that provides not only a simplified perspective but allows the use of (1 - metric) as a feature distance. With this distance hierarchical, single linkage clustering is applied to create a dendrogram visualization. This helps to identify groups of low distance, features which activate “in
tandem” to predict the outcome. Such information can then be used to either reduce clusters of highly redundant features to a subset or highlight clusters of highly synergistic features that should always be considered together.</p>
<p>For this example, let’s apply clustering to redundancy to see how the apparent grouping observed in the heatmap appears in the dendrogram. Ideally, we want to see features only start to cluster as close to the right-hand side of the dendrogram as possible. This implies all features in the model are contributing uniquely to our predictions.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># redundancy dendrogram</span>
<span class="n">redundancy_linkage</span> <span class="o">=</span> <span class="n">regression_inspector</span><span class="o">.</span><span class="n">feature_redundancy_linkage</span><span class="p">()</span>
<span class="n">DendrogramDrawer</span><span class="p">()</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Redundancy linkage&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">redundancy_linkage</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Predictive_Maintenance_Regression_with_Facet_47_0.png" src="../_images/tutorial_Predictive_Maintenance_Regression_with_Facet_47_0.png" />
</div>
</div>
<p>For convenience when working in a non-notebook environment, all of the <code class="docutils literal notranslate"><span class="pre">Drawer</span></code>s provided by the <a class="reference external" href="https://github.com/BCG-Gamma/pytools">pytools</a> package also support a <code class="docutils literal notranslate"><span class="pre">style='text'</span></code> flag.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">DendrogramDrawer</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Redundancy linkage&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">redundancy_linkage</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
****************************** Redundancy linkage ******************************

Turbine Shaft T 13% --------------------------------------\
Generator Rate  16% ------------------------------------\ |___
Turbine Rate of 13% ----------------------------\_______/-/   \
Turbine exhaust 11% ----------------------------/             |
Compressor outl 26% ----------------------------------\       \\_______________
Turbine injecti  6% ------------\_____________________/--\____||
Fuel flow        4% ------------/                        |    ||
HP Turbine exit  2% -------------------------------------/    ||
GT Compressor o  7% ------------------------------------------/|
Turbine exit pr  3% -------------------------------------------/
</pre></div></div>
</div>
<p><strong>What might we infer from synergy, redundancy and redundancy feature clustering?</strong></p>
<ul class="simple">
<li><p>We can see in the synergy matrix that many features are synergistic with <code class="docutils literal notranslate"><span class="pre">Compressor</span> <span class="pre">outlet</span> <span class="pre">air</span> <span class="pre">pressure</span> <span class="pre">(bar)</span></code>. This means <code class="docutils literal notranslate"><span class="pre">Compressor</span> <span class="pre">outlet</span> <span class="pre">air</span> <span class="pre">pressure</span> <span class="pre">(bar)</span></code> enables many other features in the model to contribute to predicting the the decay state of the gas turbine.</p></li>
<li><p>The redundancy matrix and dendrogram revealed two clusters of feature pairs that are redundant: (<code class="docutils literal notranslate"><span class="pre">Fuel</span> <span class="pre">flow</span></code>, <code class="docutils literal notranslate"><span class="pre">Turbine</span> <span class="pre">injection</span> <span class="pre">control</span></code>) and (<code class="docutils literal notranslate"><span class="pre">Turbine</span> <span class="pre">Rate</span> <span class="pre">of</span> <span class="pre">Revolutions</span> <span class="pre">(rpm)</span></code>, <code class="docutils literal notranslate"><span class="pre">Turbine</span> <span class="pre">exhaust</span> <span class="pre">gas</span> <span class="pre">pressure</span> <span class="pre">(bar)</span></code>). In the case of the second feature pair, again it seems sensible as the higher the pressure the higher the rate of revolutions.</p></li>
</ul>
<p><strong>What action(s) might we take?</strong></p>
<p>We can remove the redundant features from the sample and create a revised sample on which we re-train the pipeline. This will result in a simpler model with improved independence between features.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">redundant_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Fuel flow&quot;</span><span class="p">,</span> <span class="s2">&quot;Turbine exhaust gas pressure (bar)&quot;</span><span class="p">]</span>
<span class="n">decay_obs_no_redundant</span> <span class="o">=</span> <span class="n">decay_obs_initial_features</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">feature_names</span><span class="o">=</span><span class="n">redundant_features</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># run the training pipeline again</span>
<span class="n">regressor_ranker</span> <span class="o">=</span> <span class="n">LearnerRanker</span><span class="p">(</span>
    <span class="n">grids</span><span class="o">=</span><span class="n">regressor_grid</span><span class="p">,</span>
    <span class="n">cv</span><span class="o">=</span><span class="n">RepeatedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_repeats</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">sample</span><span class="o">=</span><span class="n">decay_obs_no_redundant</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We can also check the best ranked model after removing redundant features.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">regressor_ranker</span><span class="o">.</span><span class="n">best_model_</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RegressorPipelineDF(regressor=LGBMRegressorDF(min_data_in_leaf=8,
                                              random_state=42, subsample=0.8))
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="FACET-univariate-simulator:-the-impact-of-compressor-outlet-air-temp">
<h1>FACET univariate simulator: the impact of compressor outlet air temp<a class="headerlink" href="#FACET-univariate-simulator:-the-impact-of-compressor-outlet-air-temp" title="Permalink to this headline">¶</a></h1>
<p>Another advantage of FACET is the ability to quickly instigate and run univariate simulations. Simulation enables us to gain insight into what value(s) of a feature of interest might minimize performance decay. Further, because FACET can use bootstrap cross validation, we can create a crossfit from our previous <code class="docutils literal notranslate"><span class="pre">LearnerRanker</span></code> best model to perform the simulation and to also quantify the uncertainty by using bootstrap confidence intervals.</p>
<p>Suggesting that <code class="docutils literal notranslate"><span class="pre">GT</span> <span class="pre">Compressor</span> <span class="pre">outlet</span> <span class="pre">air</span> <span class="pre">temp</span> <span class="pre">(C)</span></code> is a parameter that operators mainly use, we would like to estimate how temperature values might impact performance decay.</p>
<p>As the basis for the simulation, we divide the feature into relevant partitions:</p>
<ul class="simple">
<li><p>We use FACET’s <code class="docutils literal notranslate"><span class="pre">ContinuousRangePartitioner</span></code> to split the range of observed values of the outlet air temperature into intervals of equal size. Each partition is represented by the central value of that partition.</p></li>
<li><p>For each partition, the simulator creates an artificial copy of the original sample assuming the variable to be simulated has the same value across all observations - which is the value representing the partition. Using the best <code class="docutils literal notranslate"><span class="pre">LearnerCrossfit</span></code> acquired from the ranker, the simulator now re-predicts all targets using the models trained for all folds and determines the average uplift of the target variable resulting from this.</p></li>
<li><p>The FACET <code class="docutils literal notranslate"><span class="pre">SimulationDrawer</span></code> allows us to visualise the result; both in a matplotlib and a plain-text style</p></li>
</ul>
<p>Finally, because FACET can use bootstrap cross validation, we can create a crossfit from our previous <code class="docutils literal notranslate"><span class="pre">LearnerRanker</span></code> best model to perform the simulation so we can quantify the uncertainty by using bootstrap confidence intervals.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">boot_crossfit</span> <span class="o">=</span> <span class="n">LearnerCrossfit</span><span class="p">(</span>
    <span class="n">pipeline</span><span class="o">=</span><span class="n">regressor_ranker</span><span class="o">.</span><span class="n">best_model_</span><span class="p">,</span>
    <span class="n">cv</span><span class="o">=</span><span class="n">BootstrapCV</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">sample</span><span class="o">=</span><span class="n">decay_obs_no_redundant</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># set-up and run a simulation</span>
<span class="n">SIM_FEATURE</span> <span class="o">=</span> <span class="s2">&quot;GT Compressor outlet air temp (C)&quot;</span>
<span class="n">GTC_air_temp_simulator</span> <span class="o">=</span> <span class="n">UnivariateUpliftSimulator</span><span class="p">(</span><span class="n">crossfit</span><span class="o">=</span><span class="n">boot_crossfit</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">GTC_air_temp_partitions</span> <span class="o">=</span> <span class="n">ContinuousRangePartitioner</span><span class="p">()</span>
<span class="n">GTC_air_temp_simulation</span> <span class="o">=</span> <span class="n">GTC_air_temp_simulator</span><span class="o">.</span><span class="n">simulate_feature</span><span class="p">(</span>
    <span class="n">feature_name</span><span class="o">=</span><span class="n">SIM_FEATURE</span><span class="p">,</span> <span class="n">partitioner</span><span class="o">=</span><span class="n">GTC_air_temp_partitions</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># visualize the results</span>
<span class="n">SimulationDrawer</span><span class="p">()</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">GTC_air_temp_simulation</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">SIM_FEATURE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Predictive_Maintenance_Regression_with_Facet_60_0.png" src="../_images/tutorial_Predictive_Maintenance_Regression_with_Facet_60_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># can also get a print out of simulation results</span>
<span class="n">SimulationDrawer</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">GTC_air_temp_simulation</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">SIM_FEATURE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
********************** GT Compressor outlet air temp (C) ***********************

Mean predicted uplift (GT Turbine decay state coeff):

Baseline = 0.0

Partition  2.5th percentile  Median     97.5th percentile
=========  ================  =========  =================
560                0.00151    0.003              0.00457
580               -0.00144   -0.000883          -0.000332
600               -0.00168   -0.00108           -0.000471
620               -0.00181   -0.00124           -0.000665
640               -0.00189   -0.00135           -0.000805
660               -0.00209   -0.0015            -0.000921
680               -0.00225   -0.00162           -0.000999
700               -0.00314   -0.00213           -0.00131
720               -0.00314   -0.00213           -0.00131
740               -0.00315   -0.00214           -0.00129
760               -0.00316   -0.00214           -0.00129
780               -0.00323   -0.00221           -0.0014

Observed frequencies:

Partition  Frequency
=========  =========
560              372
580              363
600              242
620               63
640              264
660              186
680              222
700              159
720              120
740              161
760               11
780              277

</pre></div></div>
</div>
<p>We can see from this that the turbine decay state coefficient is maximized when the outlet air temperature of the gas turbine is as small as possible. Note that this is only looking at the partitions of the historically observed range, as extrapolating these predictions into unobserved regions would risk creating infeasible scenarios.</p>
</div>
<div class="section" id="Summary">
<h1>Summary<a class="headerlink" href="#Summary" title="Permalink to this headline">¶</a></h1>
<p>With the capabilities offered by FACET we were able to:</p>
<ol class="arabic simple">
<li><p>Identify a learner using with good performance for predicting performance decay.</p></li>
<li><p>Utilize advanced the SHAP value capabilities (synergy and redundancy) to identify additional features that could be removed (i.e., fuel flow and turbine exhaust gas pressure) and whether any features had strong synergistic effects - which in this case was primarily between turbine exhaust gas pressure and turbine rate of revolutions.</p></li>
<li><p>Simulate the effect of changes in GT compressor outlet air temp on performance decay.</p></li>
</ol>
</div>
<div class="section" id="Appendix">
<h1>Appendix<a class="headerlink" href="#Appendix" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Data-source">
<h2>Data source<a class="headerlink" href="#Data-source" title="Permalink to this headline">¶</a></h2>
<p><strong>Dataset</strong></p>
<p>The dataset used in this example is available on <a class="reference external" href="https://www.kaggle.com/elikplim/maintenance-of-naval-propulsion-plants-data-set">Kaggle</a> and contains data from experiments carried out by means of a numerical simulator of a naval vessel (Frigate) characterized by a <strong>Gas Turbine propulsion plant</strong>. In this release of the simulator it is also possible to consider the performance decay over time of the GT components such as GT compressor and turbines.</p>
<p>Each possible degradation state of the plant can be characterized by three parameters:</p>
<ul class="simple">
<li><p>Ship speed (linear function of the lever position)</p></li>
<li><p>Compressor degradation coefficient kMc</p></li>
<li><p>Turbine degradation coefficient</p></li>
</ul>
<p>The degradation coefficients typically vary between [1; 0.95] for compressor and [1; 0.975] for the gas turbine.</p>
<p><strong>Features</strong></p>
<p>One observation in this dataset represents the current decay states of the compressor and the gas turbine along with several sensor readings of the shipping vessels at that point in time.</p>
<p>Our target, the Gas Turbine decay state is being modelled as a performance decay state metric which is measured as 1 to 0, 1 meaning delivering 100% of the nominal performance. Therefore, we want to determine the machine settings which <strong>maximize the gas turbine decay state coefficient</strong>.</p>
<p><strong>Learning Problem</strong></p>
<p>For this learning problem, we have three key objectives:</p>
<ol class="arabic simple">
<li><p>Predict the decay state of the gas turbine as accurately as possible</p></li>
<li><p>Understand which parameters drive the decay state of the turbine</p></li>
<li><p>Analyse how these drivers interact with each other and the target</p></li>
</ol>
<p>While we can solve questions 1 and parts of question 2 with commonly used machine learning packages, FACET will enable us to make better inferences about the way some of the features share or complement information and help us to figure out the optimal settings of the vessel to minimize the equipment degradation at a variety of ship speeds.</p>
<p>Reference for the dataset used in this example is: A. Coraddu, L. Oneto, A. Ghio, S. Savio, D. Anguita, M. Figari, Machine Learning Approaches for Improving Condition? Based Maintenance of Naval Propulsion Plants, Journal of Engineering for the Maritime Environment, 2014, DOI: 10.1177/1475090214540874, (In Press)</p>
</div>
<div class="section" id="Exploratory-Data-Analysis-(EDA)">
<h2>Exploratory Data Analysis (EDA)<a class="headerlink" href="#Exploratory-Data-Analysis-(EDA)" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">decay_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s2">&quot;sphinx/source/tutorial/gas_turbine_data.txt&quot;</span><span class="p">,</span> <span class="n">delim_whitespace</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="n">decay_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Lever Position&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Ship Speed&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Turbine Shaft Torque (kN m)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Turbine Rate of Revolutions (rpm)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Generator Rate of Revolutions (rpm)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Starboard Propeller Torque (kN)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Port Propeller Torque (kN)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HP Turbine exit temp (C)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GT Compressor inlet air temp (C)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GT Compressor outlet air temp (C)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Turbine exit pressure (bar)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Compressor inlet air pressure (bar)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Compressor outlet air pressure (bar)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Turbine exhaust gas pressure (bar)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Turbine injection control&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Fuel flow&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GT Compressor decay state coeff&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GT Turbine decay state coeff&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;GT Turbine decay state coeff&quot;</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># need to drop the other target</span>
<span class="n">decay_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;GT Compressor decay state coeff&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># describe the data</span>
<span class="n">decay_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Lever Position</th>
      <td>11933.0</td>
      <td>5.167004</td>
      <td>2.626239e+00</td>
      <td>1.138</td>
      <td>3.144</td>
      <td>5.140</td>
      <td>7.148</td>
      <td>9.300</td>
    </tr>
    <tr>
      <th>Ship Speed</th>
      <td>11933.0</td>
      <td>15.001006</td>
      <td>7.745837e+00</td>
      <td>3.000</td>
      <td>9.000</td>
      <td>15.000</td>
      <td>21.000</td>
      <td>27.000</td>
    </tr>
    <tr>
      <th>Turbine Shaft Torque (kN m)</th>
      <td>11933.0</td>
      <td>27249.757760</td>
      <td>2.214817e+04</td>
      <td>253.547</td>
      <td>8375.886</td>
      <td>21630.666</td>
      <td>39001.427</td>
      <td>72784.872</td>
    </tr>
    <tr>
      <th>Turbine Rate of Revolutions (rpm)</th>
      <td>11933.0</td>
      <td>2136.355191</td>
      <td>7.740828e+02</td>
      <td>1307.675</td>
      <td>1386.758</td>
      <td>1924.326</td>
      <td>2678.079</td>
      <td>3560.741</td>
    </tr>
    <tr>
      <th>Generator Rate of Revolutions (rpm)</th>
      <td>11933.0</td>
      <td>8201.074989</td>
      <td>1.091272e+03</td>
      <td>6589.002</td>
      <td>7058.402</td>
      <td>8482.088</td>
      <td>9132.610</td>
      <td>9797.103</td>
    </tr>
    <tr>
      <th>Starboard Propeller Torque (kN)</th>
      <td>11933.0</td>
      <td>227.354184</td>
      <td>2.004942e+02</td>
      <td>5.304</td>
      <td>60.317</td>
      <td>175.268</td>
      <td>332.365</td>
      <td>645.249</td>
    </tr>
    <tr>
      <th>Port Propeller Torque (kN)</th>
      <td>11933.0</td>
      <td>227.354184</td>
      <td>2.004942e+02</td>
      <td>5.304</td>
      <td>60.317</td>
      <td>175.268</td>
      <td>332.365</td>
      <td>645.249</td>
    </tr>
    <tr>
      <th>HP Turbine exit temp (C)</th>
      <td>11933.0</td>
      <td>735.518197</td>
      <td>1.736700e+02</td>
      <td>442.364</td>
      <td>589.875</td>
      <td>706.048</td>
      <td>834.091</td>
      <td>1115.797</td>
    </tr>
    <tr>
      <th>GT Compressor inlet air temp (C)</th>
      <td>11933.0</td>
      <td>288.000000</td>
      <td>0.000000e+00</td>
      <td>288.000</td>
      <td>288.000</td>
      <td>288.000</td>
      <td>288.000</td>
      <td>288.000</td>
    </tr>
    <tr>
      <th>GT Compressor outlet air temp (C)</th>
      <td>11933.0</td>
      <td>646.223347</td>
      <td>7.267365e+01</td>
      <td>540.442</td>
      <td>578.102</td>
      <td>637.142</td>
      <td>693.928</td>
      <td>789.094</td>
    </tr>
    <tr>
      <th>Turbine exit pressure (bar)</th>
      <td>11933.0</td>
      <td>2.353068</td>
      <td>1.084754e+00</td>
      <td>1.093</td>
      <td>1.389</td>
      <td>2.083</td>
      <td>2.981</td>
      <td>4.560</td>
    </tr>
    <tr>
      <th>Compressor inlet air pressure (bar)</th>
      <td>11933.0</td>
      <td>0.998000</td>
      <td>1.110270e-16</td>
      <td>0.998</td>
      <td>0.998</td>
      <td>0.998</td>
      <td>0.998</td>
      <td>0.998</td>
    </tr>
    <tr>
      <th>Compressor outlet air pressure (bar)</th>
      <td>11933.0</td>
      <td>12.297655</td>
      <td>5.337355e+00</td>
      <td>5.828</td>
      <td>7.448</td>
      <td>11.092</td>
      <td>15.658</td>
      <td>23.140</td>
    </tr>
    <tr>
      <th>Turbine exhaust gas pressure (bar)</th>
      <td>11933.0</td>
      <td>1.029475</td>
      <td>1.039031e-02</td>
      <td>1.019</td>
      <td>1.020</td>
      <td>1.026</td>
      <td>1.036</td>
      <td>1.052</td>
    </tr>
    <tr>
      <th>Turbine injection control</th>
      <td>11933.0</td>
      <td>33.643482</td>
      <td>2.584131e+01</td>
      <td>0.000</td>
      <td>13.700</td>
      <td>25.277</td>
      <td>44.553</td>
      <td>92.556</td>
    </tr>
    <tr>
      <th>Fuel flow</th>
      <td>11933.0</td>
      <td>0.662488</td>
      <td>5.071251e-01</td>
      <td>0.068</td>
      <td>0.246</td>
      <td>0.496</td>
      <td>0.882</td>
      <td>1.832</td>
    </tr>
    <tr>
      <th>GT Turbine decay state coeff</th>
      <td>11933.0</td>
      <td>0.987501</td>
      <td>7.499755e-03</td>
      <td>0.975</td>
      <td>0.981</td>
      <td>0.988</td>
      <td>0.994</td>
      <td>1.000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>We can also quickly check for missing values, although we can see that there appears to be none.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># count missing by feature</span>
<span class="n">decay_df</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Lever Position                          0
Ship Speed                              0
Turbine Shaft Torque (kN m)             0
Turbine Rate of Revolutions (rpm)       0
Generator Rate of Revolutions (rpm)     0
Starboard Propeller Torque (kN)         0
Port Propeller Torque (kN)              0
HP Turbine exit temp (C)                0
GT Compressor inlet air temp (C)        0
GT Compressor outlet air temp (C)       0
Turbine exit pressure (bar)             0
Compressor inlet air pressure (bar)     0
Compressor outlet air pressure (bar)    0
Turbine exhaust gas pressure (bar)      0
Turbine injection control               0
Fuel flow                               0
GT Turbine decay state coeff            0
dtype: int64
</pre></div></div>
</div>
<p>We can use pytool’s <code class="docutils literal notranslate"><span class="pre">ECDFDrawer()</span></code> to draw the cumulative distribution of the target. This shows us that the target is uniformly distributed in increments of 0.001 increments.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># look at the target distribution</span>
<span class="n">decay_obs</span> <span class="o">=</span> <span class="n">Sample</span><span class="p">(</span><span class="n">observations</span><span class="o">=</span><span class="n">decay_df</span><span class="p">,</span> <span class="n">target_name</span><span class="o">=</span><span class="n">TARGET</span><span class="p">)</span>
<span class="n">ECDFDrawer</span><span class="p">()</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">decay_obs</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Predictive_Maintenance_Regression_with_Facet_73_0.png" src="../_images/tutorial_Predictive_Maintenance_Regression_with_Facet_73_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># look at feature distributions and correlations</span>
<span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">decay_obs</span><span class="o">.</span><span class="n">features</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;seaborn.axisgrid.PairGrid at 0x1ab0fe8b700&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Predictive_Maintenance_Regression_with_Facet_74_1.png" src="../_images/tutorial_Predictive_Maintenance_Regression_with_Facet_74_1.png" />
</div>
</div>
<p><strong>Quick EDA summary:</strong></p>
<ul class="simple">
<li><p>We have no missing values in our data</p></li>
<li><p>We are dealing with a linearly distributed target</p></li>
<li><p>The features exhibit a mixture of linear and non-linear relationships amongst each other. This gives us reason to test several non-parametric models and compare their performance</p></li>
</ul>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="Water_Drilling_Incident_Classification_with_Facet.html" title="previous page">Introduction to FACET</a>
    <a class='right-next' id="next-link" href="Classification_with_Facet.html" title="next page">Classification with FACET: Prediabetes Study</a>

              </div>
              
          </main>
          

      </div>
    </div>

    
  <script src="../_static/js/index.3da636dd464baa7582d2.js"></script>


    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2020, Boston Consulting Group (BCG).<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.2.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>