{% set setup_py_data = load_setup_py_data() %}

package:
  name: gamma-facet
  version: {{ environ.get('FACET_BUILD_FACET_VERSION') }}

source:
  git_url: {{FACET_PATH}}/facet

build:
  noarch: python
  script: "flit install --deps none"

requirements:
  host:
    - pip>=20.*
    - python {{ environ.get('FACET_V_PYTHON', '=3.8.*') }}
    - flit>=3.0.*
  run:
    - python{{ environ.get('FACET_V_PYTHON') }}
    - pandas{{ environ.get('FACET_V_PANDAS') }}
    - numpy{{ environ.get('FACET_V_NUMPY') }}
    - scipy{{ environ.get('FACET_V_SCIPY') }}
    - matplotlib{{ environ.get('FACET_V_MATPLOTLIB') }}
    - scikit-learn{{ environ.get('FACET_V_SCIKIT_LEARN') }}
    - shap{{ environ.get('FACET_V_SHAP') }}
    - gamma-pytools{{ environ.get('FACET_V_GAMMA_PYTOOLS') }}
    - gamma-sklearndf{{ environ.get('FACET_V_GAMMA_SKLEARNDF') }}
    - pyyaml{{ environ.get('FACET_V_PYYAML') }}
test:
  imports:
    - facet
    - facet.crossfit
    - facet.inspection
    - facet.selection
    - facet.validation
    - facet.simulation
  requires:
    - pytest=5.2.*
  commands:
    - conda list
    - python -c 'import facet;
                 import os;
                 assert facet.__version__ == os.environ["PKG_VERSION"]'
    - pytest -vs ${FACET_PATH}/pytools/test
    - pytest -vs ${FACET_PATH}/sklearndf/test
    - pytest -vs ${FACET_PATH}/facet/test
